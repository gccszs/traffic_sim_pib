# ğŸš€ WebSocket è¿æ¥é—®é¢˜ - å¿«é€Ÿä¿®å¤æŒ‡å—

**é—®é¢˜**: å¼•æ“å¯åŠ¨å WebSocket æ¡æ‰‹è¢«æ‹’ç»  
**åŸå› **: Java åç«¯æœªå¯åŠ¨  
**çŠ¶æ€**: âœ… å·²ç¡®è®¤ï¼Œå‡†å¤‡ä¿®å¤

---

## âš¡ å¿«é€Ÿä¿®å¤ï¼ˆæ¨èï¼‰

### æ–¹æ³• 1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰

**åŒå‡»è¿è¡Œ**ï¼š
```
å¯åŠ¨Javaåç«¯.bat
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… æ£€æŸ¥ Java ç¯å¢ƒ
- âœ… æ£€æŸ¥ç«¯å£å ç”¨
- âœ… æ£€æŸ¥ JAR æ–‡ä»¶
- âœ… å¯åŠ¨ Java åç«¯

**ç­‰å¾…çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯è¡¨ç¤ºå¯åŠ¨æˆåŠŸ**ï¼š
```
Started TrafficSimServerApplication in X.XXX seconds
Tomcat started on port(s): 3822 (http)
```

---

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨å¯åŠ¨

#### Windows:

```powershell
# è¿›å…¥ Java åç«¯ç›®å½•
cd traffic-sim-server

# å¯åŠ¨æœåŠ¡
java -jar target\traffic-sim-server-1.0.0-SNAPSHOT.jar
```

#### Linux/Mac:

```bash
# è¿›å…¥ Java åç«¯ç›®å½•
cd traffic-sim-server

# å¯åŠ¨æœåŠ¡
java -jar target/traffic-sim-server-1.0.0-SNAPSHOT.jar
```

---

### æ–¹æ³• 3ï¼šä½¿ç”¨ Maven å¯åŠ¨

```bash
cd traffic-sim-server
mvn spring-boot:run
```

---

### æ–¹æ³• 4ï¼šä½¿ç”¨ IDE å¯åŠ¨

1. ç”¨ IntelliJ IDEA æˆ– Eclipse æ‰“å¼€é¡¹ç›®
2. æ‰¾åˆ°ä¸»ç±»ï¼š`com.traffic.sim.TrafficSimServerApplication`
3. å³é”® â†’ Run 'TrafficSimServerApplication'

---

## âœ… éªŒè¯å¯åŠ¨æˆåŠŸ

### 1. æ£€æŸ¥ç«¯å£ç›‘å¬

```powershell
netstat -ano | findstr :3822
```

**åº”è¯¥çœ‹åˆ°**ï¼š
```
TCP    0.0.0.0:3822           0.0.0.0:0              LISTENING       12345
```

### 2. æ£€æŸ¥æ—¥å¿—

æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œåº”è¯¥åŒ…å«ï¼š
```
Started TrafficSimServerApplication in X.XXX seconds (JVM running for X.XXX)
Tomcat started on port(s): 3822 (http) with context path '/api'
```

### 3. æµ‹è¯• API

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:3822/api/swagger-ui.html
```

åº”è¯¥èƒ½çœ‹åˆ° Swagger API æ–‡æ¡£é¡µé¢ã€‚

---

## ğŸ”„ å®Œæ•´å¯åŠ¨æµç¨‹

å¯åŠ¨é¡ºåºå¾ˆé‡è¦ï¼è¯·æŒ‰ä»¥ä¸‹é¡ºåºå¯åŠ¨ï¼š

### 1ï¸âƒ£ å¯åŠ¨åŸºç¡€è®¾æ–½ï¼ˆå¦‚æœä½¿ç”¨ Dockerï¼‰

```bash
cd infrastructure
docker-compose up -d
```

ç­‰å¾… MySQLã€MongoDBã€Redis å¯åŠ¨å®Œæˆï¼ˆçº¦ 30 ç§’ï¼‰ã€‚

### 2ï¸âƒ£ å¯åŠ¨ Java åç«¯ â­ å…³é”®æ­¥éª¤

```bash
# æ–¹æ³• Aï¼šä½¿ç”¨è„šæœ¬
å¯åŠ¨Javaåç«¯.bat

# æ–¹æ³• Bï¼šæ‰‹åŠ¨å¯åŠ¨
cd traffic-sim-server
java -jar target\traffic-sim-server-1.0.0-SNAPSHOT.jar
```

**ç­‰å¾…å¯åŠ¨å®Œæˆ**ï¼ˆçœ‹åˆ° "Started TrafficSimServerApplication"ï¼‰ã€‚

### 3ï¸âƒ£ å¯åŠ¨ Python æœåŠ¡

```bash
cd map_convert_services
start.bat  # Windows
# æˆ–
bash start.sh  # Linux/Mac
```

### 4ï¸âƒ£ æµ‹è¯•åˆ›å»ºä»¿çœŸ

- æ‰“å¼€å‰ç«¯
- åˆ›å»ºä»¿çœŸä»»åŠ¡
- æ£€æŸ¥å¼•æ“æ˜¯å¦æˆåŠŸè¿æ¥

---

## ğŸ¯ éªŒè¯ä¿®å¤æˆåŠŸ

### æ£€æŸ¥æ¸…å•

- [ ] **Java åç«¯å·²å¯åŠ¨**
  ```bash
  netstat -ano | findstr :3822
  # åº”è¯¥çœ‹åˆ° LISTENING
  ```

- [ ] **Java åç«¯æ—¥å¿—æ­£å¸¸**
  - æ— å¯åŠ¨é”™è¯¯
  - æ˜¾ç¤º "Started TrafficSimServerApplication"
  - æ˜¾ç¤º "Tomcat started on port(s): 3822"

- [ ] **Python æœåŠ¡å·²å¯åŠ¨**
  ```bash
  netstat -ano | findstr :50051
  netstat -ano | findstr :50052
  # åº”è¯¥çœ‹åˆ° LISTENING
  ```

- [ ] **åˆ›å»ºä»¿çœŸæµ‹è¯•**
  - é€šè¿‡å‰ç«¯åˆ›å»ºä»¿çœŸä»»åŠ¡
  - ä¸å†å‡ºç° "WebSocket handshake was declined" é”™è¯¯

- [ ] **å¼•æ“è¿æ¥æˆåŠŸ**
  - å¼•æ“æ—¥å¿—æ˜¾ç¤ºï¼š`[+] Connected to backend successfully`
  - Java æ—¥å¿—æ˜¾ç¤ºï¼š`Engine WebSocket connected: {sessionId}`

- [ ] **ä»¿çœŸè¿è¡Œæ­£å¸¸**
  - å¯åŠ¨ä»¿çœŸ
  - ä¸¤ç«¯ç»ˆç«¯éƒ½èƒ½è¾“å‡ºå®æ—¶æ•°æ®
  - å‰ç«¯æ˜¾ç¤ºå®æ—¶ä»¿çœŸä¿¡æ¯

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: å¯åŠ¨æ—¶æç¤º "Port 3822 already in use"

**åŸå› **ï¼šç«¯å£è¢«å ç”¨  
**è§£å†³**ï¼š

```powershell
# 1. æŸ¥æ‰¾å ç”¨è¿›ç¨‹
netstat -ano | findstr :3822

# 2. ç»“æŸè¿›ç¨‹ï¼ˆæ›¿æ¢ <PID> ä¸ºå®é™…è¿›ç¨‹IDï¼‰
taskkill /PID <PID> /F

# 3. é‡æ–°å¯åŠ¨
```

### Q2: å¯åŠ¨æ—¶æç¤º "Unable to connect to MySQL"

**åŸå› **ï¼šMySQL æœªå¯åŠ¨  
**è§£å†³**ï¼š

```bash
# å¯åŠ¨ MySQLï¼ˆå¦‚æœä½¿ç”¨ Dockerï¼‰
cd infrastructure
docker-compose up -d mysql

# ç­‰å¾… 30 ç§’åé‡æ–°å¯åŠ¨ Java åç«¯
```

### Q3: å¯åŠ¨æ—¶æç¤º "Unable to connect to MongoDB"

**åŸå› **ï¼šMongoDB æœªå¯åŠ¨  
**è§£å†³**ï¼š

```bash
# å¯åŠ¨ MongoDBï¼ˆå¦‚æœä½¿ç”¨ Dockerï¼‰
cd infrastructure
docker-compose up -d mongodb

# ç­‰å¾… 30 ç§’åé‡æ–°å¯åŠ¨ Java åç«¯
```

### Q4: å¯åŠ¨æˆåŠŸä½†å¼•æ“ä»ç„¶è¿æ¥å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. WebSocket è·¯å¾„é…ç½®ä¸åŒ¹é…
2. é˜²ç«å¢™é˜»æ­¢è¿æ¥
3. å¼•æ“å¯åŠ¨å‘½ä»¤é”™è¯¯

**è¯Šæ–­æ­¥éª¤**ï¼š

```bash
# 1. ç¡®è®¤ Java åç«¯ WebSocket ç«¯ç‚¹
# æŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥åŒ…å« WebSocket ç›¸å…³é…ç½®

# 2. ç¡®è®¤å¼•æ“å¯åŠ¨å‘½ä»¤
# æŸ¥çœ‹ Python æ—¥å¿—ï¼Œåº”è¯¥åŒ…å«ï¼š
# --port=3822 --ws=ws://localhost:3822/ws/exe/{sessionId}

# 3. æµ‹è¯• WebSocket è¿æ¥
# ä½¿ç”¨åœ¨çº¿å·¥å…·æµ‹è¯•ï¼šws://localhost:3822/api/ws/exe/test
```

### Q5: æ‰¾ä¸åˆ° JAR æ–‡ä»¶

**åŸå› **ï¼šé¡¹ç›®æœªç¼–è¯‘  
**è§£å†³**ï¼š

```bash
cd traffic-sim-server

# ç¼–è¯‘é¡¹ç›®
mvn clean package -DskipTests

# ç¼–è¯‘å®Œæˆåå¯åŠ¨
java -jar target\traffic-sim-server-1.0.0-SNAPSHOT.jar
```

---

## ğŸ“Š æ¶æ„è¯´æ˜

ä¿®å¤åçš„æ­£ç¡®æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯   â”‚â—„â”€â”€WebSocket 3822â”€â”€â–ºâ”‚  Java åç«¯   â”‚â—„â”€â”€WebSocket 3822â”€â”€â–ºâ”‚  å¼•æ“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚                                  â–²
                                      â”‚ gRPC 50051                       â”‚
                                      â–¼                                  â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
                               â”‚ Python æœåŠ¡  â”‚â”€â”€â”€â”€â”€â”€å¯åŠ¨å¼•æ“â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   (é…ç½®è¿æ¥ Java 3822)
```

**å…³é”®ç‚¹**ï¼š
- âœ… Java åç«¯å¿…é¡»å…ˆå¯åŠ¨ï¼ˆç›‘å¬ 3822 ç«¯å£ï¼‰
- âœ… Python æœåŠ¡é€šè¿‡ gRPC æ¥æ”¶åˆ›å»ºå¼•æ“çš„è¯·æ±‚
- âœ… Python æœåŠ¡å¯åŠ¨å¼•æ“ï¼Œé…ç½®å¼•æ“è¿æ¥åˆ° Java 3822
- âœ… å¼•æ“ç›´æ¥ä¸ Java åç«¯é€šä¿¡ï¼ˆä¸é€šè¿‡ Pythonï¼‰

---

## ğŸ“ ç«¯å£è¯´æ˜

| ç«¯å£ | æœåŠ¡ | åè®® | ç”¨é€” | çŠ¶æ€ |
|------|------|------|------|------|
| **3822** | Java åç«¯ | HTTP/WebSocket | **å¼•æ“å’Œå‰ç«¯è¿æ¥** | â­ å¿…é¡»å¯åŠ¨ |
| 8000 | Python FastAPI | HTTP | å…¼å®¹æ—§ç‰ˆ | å¯é€‰ |
| 50051 | Python gRPC | gRPC | ä»¿çœŸæœåŠ¡ | å¿…éœ€ |
| 50052 | Python gRPC | gRPC | åœ°å›¾è½¬æ¢ | å¿…éœ€ |
| 3306 | MySQL | TCP | æ•°æ®åº“ | å¿…éœ€ |
| 27017 | MongoDB | TCP | æ•°æ®åº“ | å¿…éœ€ |
| 6379 | Redis | TCP | ç¼“å­˜ | å¯é€‰ |

---

## ğŸ‰ ä¿®å¤å®Œæˆå

å¯åŠ¨æˆåŠŸåï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

1. âœ… åˆ›å»ºä»¿çœŸä»»åŠ¡ï¼ˆä¸å†æŠ¥é”™ï¼‰
2. âœ… å¼•æ“æˆåŠŸè¿æ¥åˆ° Java åç«¯
3. âœ… å¯åŠ¨ä»¿çœŸå¹¶çœ‹åˆ°å®æ—¶æ•°æ®
4. âœ… å‰ç«¯æ˜¾ç¤ºå®æ—¶ä»¿çœŸä¿¡æ¯
5. âœ… ä¸¤ç«¯ç»ˆç«¯éƒ½èƒ½è¾“å‡ºå®æ—¶ä¿¡æ¯

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä»ç„¶æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. Java åç«¯å¯åŠ¨æ—¥å¿—ï¼ˆå®Œæ•´è¾“å‡ºï¼‰
2. `netstat -ano | findstr :3822` çš„ç»“æœ
3. å¼•æ“æ—¥å¿—æ–‡ä»¶å†…å®¹
4. Python æœåŠ¡æ—¥å¿—

---

**ä¿®å¤æ—¶é—´**: é¢„è®¡ 2-5 åˆ†é’Ÿ  
**éš¾åº¦**: â­ ç®€å•ï¼ˆåªéœ€å¯åŠ¨æœåŠ¡ï¼‰  
**æˆåŠŸç‡**: 99%

**ç«‹å³å¼€å§‹ä¿®å¤** â†’ åŒå‡»è¿è¡Œ `å¯åŠ¨Javaåç«¯.bat`
