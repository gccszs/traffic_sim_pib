syntax = "proto3";

package com.traffic.sim.plugin.map.grpc;

option java_package = "com.traffic.sim.plugin.map.grpc";
option java_outer_classname = "MapServiceProto";
option java_multiple_files = true;

// 地图转换服务
service MapConvertService {
  // 转换地图文件
  rpc ConvertMap(ConvertMapRequest) returns (ConvertMapResponse);
  
  // 预览地图（简化转换，用于快速预览）
  rpc PreviewMap(PreviewMapRequest) returns (PreviewMapResponse);
}

// 地图转换请求
message ConvertMapRequest {
  // 文件内容（二进制）
  bytes file_content = 1;
  // 原始文件名
  string file_name = 2;
  // 用户ID（用于创建工作目录）
  string user_id = 3;
}

// 地图转换响应
message ConvertMapResponse {
  // 是否成功
  bool success = 1;
  // 消息（错误信息或成功提示）
  string message = 2;
  // 转换后的XML数据
  bytes xml_data = 3;
  // XML文件名
  string xml_file_name = 4;
  // 转换方法（old/new）
  string conversion_method = 5;
}

// 地图预览请求
message PreviewMapRequest {
  // 文件内容（二进制）
  bytes file_content = 1;
  // 原始文件名
  string file_name = 2;
  // 用户ID
  string user_id = 3;
}

// 地图预览响应
message PreviewMapResponse {
  // 是否成功
  bool success = 1;
  // 消息
  string message = 2;
  // 预览数据（简化的地图信息JSON）
  string preview_data = 3;
  // 道路数量
  int32 road_count = 4;
  // 交叉口数量
  int32 intersection_count = 5;
}

