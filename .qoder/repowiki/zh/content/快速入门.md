# 快速入门

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [infrastructure/docker-compose.yml](file://infrastructure/docker-compose.yml)
- [infrastructure/start.sh](file://infrastructure/start.sh)
- [infrastructure/stop.sh](file://infrastructure/stop.sh)
- [traffic-sim-server/src/main/resources/application.yml](file://traffic-sim-server/src/main/resources/application.yml)
- [traffic-sim-server/src/main/java/com/traffic/sim/TrafficSimApplication.java](file://traffic-sim-server/src/main/java/com/traffic/sim/TrafficSimApplication.java)
- [plugins/plugin-auth/src/main/java/com/traffic/sim/plugin/auth/controller/AuthController.java](file://plugins/plugin-auth/src/main/java/com/traffic/sim/plugin/auth/controller/AuthController.java)
- [frontend/index.html](file://frontend/index.html)
- [infrastructure/init.sql](file://infrastructure/init.sql)
</cite>

## 目录
1. [简介](#简介)
2. [环境准备](#环境准备)
3. [启动基础设施服务](#启动基础设施服务)
4. [编译与运行主服务](#编译与运行主服务)
5. [端到端API调用示例](#端到端api调用示例)
6. [配置文件说明](#配置文件说明)
7. [前端访问](#前端访问)

## 简介
本指南旨在帮助新手用户在本地环境中成功搭建和运行交通仿真系统。内容涵盖从代码克隆到服务启动的完整流程，包括基础设施服务的部署、项目编译、API调用示例以及前端访问方式。

## 环境准备
在开始之前，请确保您的系统已安装以下软件：

- **JDK 17+**：用于编译和运行Java应用程序。
- **Maven 3.6+**：用于项目构建和依赖管理。
- **Docker**：用于容器化部署数据库和中间件服务。
- **Docker Compose**：用于一键启动所有基础设施服务。

您可以通过以下命令验证环境是否正确安装：
```bash
java -version
mvn -version
docker --version
docker-compose --version
```

**Section sources**
- [README.md](file://README.md#L90-L96)

## 启动基础设施服务
交通仿真系统依赖多个基础设施服务，包括MySQL、MongoDB、Redis、Kafka等。这些服务通过Docker Compose进行管理。

### 使用docker-compose.yml启动服务
系统提供了`docker-compose.yml`文件来定义所有基础设施服务。该文件位于`infrastructure/`目录下，包含以下主要服务：
- **MySQL**：用于存储用户、地图、仿真任务等结构化数据。
- **MongoDB**：用于存储地图文件等非结构化数据。
- **Redis**：用于缓存和会话管理。
- **Kafka**：用于消息队列和事件驱动架构。

### 使用启动和停止脚本
系统提供了便捷的启动和停止脚本，位于`infrastructure/`目录下。

**启动服务**
```bash
cd infrastructure
./start.sh
```
该脚本会自动检查Docker环境，并启动所有定义在`docker-compose.yml`中的服务。

**停止服务**
```bash
cd infrastructure
./stop.sh
```
该脚本会停止所有正在运行的服务。

**脚本功能说明**
- `start.sh`：检查Docker环境，启动所有服务，并显示服务状态和访问地址。
- `stop.sh`：停止所有服务，并提供删除容器和数据卷的提示。

**服务访问地址**
- MySQL: localhost:3306
- MongoDB: localhost:27017
- Redis: localhost:6379
- Kafka: localhost:9092
- Kafka UI: http://localhost:8081

**Section sources**
- [infrastructure/docker-compose.yml](file://infrastructure/docker-compose.yml#L1-L253)
- [infrastructure/start.sh](file://infrastructure/start.sh#L1-L59)
- [infrastructure/stop.sh](file://infrastructure/stop.sh#L1-L21)

## 编译与运行主服务
完成基础设施服务的启动后，接下来需要编译并运行主服务。

### 编译项目
使用Maven命令编译整个项目：
```bash
mvn clean install
```
该命令会编译所有模块，包括主服务和插件模块，并将它们打包成一个可执行的JAR文件。

### 运行主服务
编译成功后，进入`traffic-sim-server`目录并运行主服务：
```bash
cd traffic-sim-server
mvn spring-boot:run
```
或者直接运行主类：`com.traffic.sim.TrafficSimApplication`。

主服务启动后，默认监听端口为8080，API上下文路径为`/api`。

**Section sources**
- [pom.xml](file://pom.xml#L1-L160)
- [traffic-sim-server/src/main/java/com/traffic/sim/TrafficSimApplication.java](file://traffic-sim-server/src/main/java/com/traffic/sim/TrafficSimApplication.java#L1-L44)

## 端到端API调用示例
本节提供一个完整的端到端示例，演示如何通过API完成用户注册、登录和访问受保护的资源。

### 1. 用户注册
使用`curl`命令注册一个新用户：
```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123",
    "email": "testuser@example.com",
    "phoneNumber": "13800138000",
    "institution": "Test Institution"
  }'
```

### 2. 用户登录
注册成功后，使用用户名和密码登录以获取JWT令牌：
```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123"
  }'
```
登录成功后，服务器会返回包含JWT令牌的响应。

### 3. 访问受保护的API端点
使用获取到的JWT令牌访问受保护的API端点。例如，获取用户信息：
```bash
curl -X GET http://localhost:8080/api/user/1 \
  -H "Authorization: Bearer <your-jwt-token>"
```

**API端点说明**
- `/api/auth/register`：用户注册
- `/api/auth/login`：用户登录
- `/api/user/{id}`：获取用户信息（需要JWT令牌）

**Section sources**
- [plugins/plugin-auth/src/main/java/com/traffic/sim/plugin/auth/controller/AuthController.java](file://plugins/plugin-auth/src/main/java/com/traffic/sim/plugin/auth/controller/AuthController.java#L38-L71)

## 配置文件说明
系统的配置文件位于`traffic-sim-server/src/main/resources/`目录下，主要包括`application.yml`文件。

### application.yml关键配置
该文件包含了数据库、服务器、日志等核心配置。

**数据库配置**
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/traffic_sim
    username: root
    password: root
  data:
    mongodb:
      uri: mongodb://root:root@localhost:27017/traffic_sim?authSource=admin
```

**服务器配置**
```yaml
server:
  port: 8080
  servlet:
    context-path: /api
```

**日志配置**
```yaml
logging:
  level:
    root: INFO
    com.traffic.sim: DEBUG
```

**Section sources**
- [traffic-sim-server/src/main/resources/application.yml](file://traffic-sim-server/src/main/resources/application.yml#L1-L118)

## 前端访问
系统提供了一个简单的前端页面，用于展示和交互。

### 访问方式
前端页面位于`frontend/`目录下，文件名为`index.html`。您可以通过以下方式访问：
1. 启动主服务后，前端资源会自动通过Spring Boot的静态资源服务提供。
2. 在浏览器中访问：`http://localhost:8080`

### 功能说明
前端页面是一个单页应用（SPA），主要功能包括：
- 用户登录和注册界面
- 地图管理和上传
- 仿真任务创建和监控
- 实时数据可视化

**Section sources**
- [frontend/index.html](file://frontend/index.html#L1-L15)